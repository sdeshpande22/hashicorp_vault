pipeline {
    agent any
    
    parameters {
        choice(name: 'AuthenticationType', choices: ['BasicAuth', 'Token'], description: 'Select authentication type')
        // Active Choices Parameters
        // These parameters will be dynamically shown based on the AuthenticationType
        choice(name: 'APIUrl', choices: [''], description: 'Enter API URL')
        choice(name: 'Username', choices: [''], description: 'Enter username')
        password(name: 'Password', defaultValue: '', description: 'Enter password')
        choice(name: 'Token', choices: [''], description: 'Enter token')
    }
    
    stages {
        stage('Setup Parameters') {
            steps {
                script {
                    // Dynamically control visibility based on AuthenticationType
                    if (params.AuthenticationType == 'BasicAuth') {
                        // Display BasicAuth related parameters
                        echo "Using BasicAuth"
                        env.API_URL = input message: 'API URL:', parameters: [string(defaultValue: '', description: 'Enter API URL', name: 'APIUrl')]
                        env.USERNAME = input message: 'Username:', parameters: [string(defaultValue: '', description: 'Enter username', name: 'Username')]
                        env.PASSWORD = input message: 'Password:', parameters: [password(description: 'Enter password', defaultValue: '', name: 'Password')]
                    } else {
                        // Display Token related parameters
                        echo "Using Token"
                        env.API_URL = input message: 'API URL:', parameters: [string(defaultValue: '', description: 'Enter API URL', name: 'APIUrl')]
                        env.TOKEN = input message: 'Token:', parameters: [string(defaultValue: '', description: 'Enter token', name: 'Token')]
                    }
                }
            }
        }
        
        stage('Build') {
            steps {
                script {
                    if (params.AuthenticationType == 'BasicAuth') {
                        echo "Using BasicAuth with URL: ${env.API_URL}, Username: ${env.USERNAME}"
                        // Add your build steps here using BasicAuth credentials
                    } else {
                        echo "Using Token with URL: ${env.API_URL}, Token: ${env.TOKEN}"
                        // Add your build steps here using Token
                    }
                }
            }
        }
    }
}
