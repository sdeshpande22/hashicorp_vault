def promptForBasicAuthParams() {
    def params = input(
        id: 'basicAuthInput',
        message: 'Provide Basic Authentication details',
        parameters: [
            string(name: 'USERNAME', defaultValue: '', description: 'Enter username for BasicAuth'),
            password(name: 'PASSWORD', defaultValue: '', description: 'Enter password for BasicAuth'),
            string(name: 'API_URL', defaultValue: '', description: 'Enter API URL')
        ]
    )
    return params
}

def promptForTokenParams() {
    def params = input(
        id: 'tokenInput',
        message: 'Provide Token Authentication details',
        parameters: [
            string(name: 'TOKEN', defaultValue: '', description: 'Enter token for Token authentication'),
            string(name: 'API_URL', defaultValue: '', description: 'Enter API URL')
        ]
    )
    return params
}

pipeline {
    agent any
    
    stages {
        stage('Authentication Method') {
            steps {
                script {
                    def authMethod = input(
                        id: 'authMethod',
                        message: 'Choose authentication method',
                        parameters: [
                            choice(
                                name: 'AUTH_METHOD',
                                choices: ['BasicAuth', 'Token'],
                                description: 'Select authentication method'
                            )
                        ]
                    )
                    
                    if (authMethod == 'BasicAuth') {
                        params = promptForBasicAuthParams()
                    } else if (authMethod == 'Token') {
                        params = promptForTokenParams()
                    }
                }
            }
        }
        
        stage('Configure') {
            steps {
                script {
                    if (params.AUTH_METHOD == 'BasicAuth') {
                        echo "Using Basic Authentication"
                        echo "Username: ${params.USERNAME}"
                        echo "Password: ${params.PASSWORD}"
                        echo "API URL: ${params.API_URL}"
                        // Add your steps using BasicAuth here
                    } else if (params.AUTH_METHOD == 'Token') {
                        echo "Using Token Authentication"
                        echo "Token: ${params.TOKEN}"
                        echo "API URL: ${params.API_URL}"
                        // Add your steps using Token here
                    } else {
                        error "Invalid authentication method selected"
                    }
                }
            }
        }
    }
}
