pipeline {
    agent any

    stages {
        stage('Capture Initiator Info') {
            steps {
                script {
                    // Access build information
                    def buildUser = currentBuild.rawBuild.getCause(hudson.model.Cause$UserIdCause)?.getUserId()
                    def buildUserId = currentBuild.rawBuild.getCause(hudson.model.Cause$UserIdCause)?.getUserName()

                    // Set INITIATOR environment variable
                    env.INITIATOR = "${buildUser}-${buildUserId}"

                    echo "The build was initiated by: ${env.INITIATOR}"
                }
            }
        }

        stage('Run Python Script') {
            steps {
                // Pass INITIATOR environment variable as parameter to Python script
                sh "python3 print_initiator.py '${env.INITIATOR}'"
            }
        }
    }
}
