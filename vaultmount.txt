apiVersion: v1
kind: Pod
metadata:
  name: my-app
  annotations:
    vault.hashicorp.com/agent-init-first: "true"
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/agent-inject-secret-db-credentials: "secrets/kv_v2/lap/db-credentials"
spec:
  containers:
  - name: my-app-container
    image: nexus3.systems.uk.hsbc:18080/hsbc-12637960-ctoepe-epeplft/idp-eda-workflow-manager:latest
    command:
    - /bin/sh
    - "-c"
    - |
      export DB_CONN_STR=$(cat /vault/secrets/db-credentials); echo "DB_CONN_STR=$DB_CONN_STR"; ./start-my-app
    volumeMounts:
    - name: vault-secret-volume
      mountPath: /vault/secrets
  volumes:
  - name: vault-secret-volume
    emptyDir: {}
