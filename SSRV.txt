import requests
from requests.auth import HTTPBasicAuth
from xml.etree import ElementTree as ET

# Set SSRS Web Service URL and report path
ssrs_url = 'http://your-ssrs-server/reportserver/ReportService2010.asmx'
report_path = '/YourReportFolder/YourReport'

# Authentication for SSRS Web Service
username = 'your_username'
password = 'your_password'

# SOAP Request to get parameter valid values for 'Machine'
soap_body = f"""
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:rs="http://schemas.microsoft.com/SQLServer/2005/06/30/reporting/reportingservices">
   <soap:Header/>
   <soap:Body>
      <rs:GetReportParameterValidValues>
         <Report>{report_path}</Report>
         <ParameterName>Machine</ParameterName>
         <MaximumNumberOfValues>100</MaximumNumberOfValues>
      </rs:GetReportParameterValidValues>
   </soap:Body>
</soap:Envelope>
"""

# Send SOAP request to the SSRS Web Service
response = requests.post(ssrs_url, data=soap_body, auth=HTTPBasicAuth(username, password), headers={'Content-Type': 'application/soap+xml; charset=utf-8'})

# Check if the request was successful
if response.status_code == 200:
    print("Valid values for 'Machine' parameter:")
    try:
        # Parse the XML response and extract valid values
        tree = ET.ElementTree(ET.fromstring(response.content))
        root = tree.getroot()

        # Look for the 'Value' elements that contain valid machine names
        valid_values = [value.text for value in root.iter('Value')]

        # Print the valid values for 'Machine' parameter
        print(valid_values)
    except Exception as e:
        print(f"Error parsing response: {e}")
else:
    print(f"Error: {response.status_code} - {response.text}")
