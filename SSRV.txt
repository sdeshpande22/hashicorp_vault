import requests
from requests.auth import HTTPBasicAuth
from urllib.parse import quote

# Prompt user for input
machine = input("Enter Machine name (e.g., ZAW25104285): ")
update_list = input("Enter Update List (e.g., SRV Baseline - Mar 25): ")

# URL-encode the report path and parameters
base_url = "http://reportingsitesrv.hbeu.adroot.hsbc/ReportServer?"
report_path = "/ConfigMgr_SRV/HSBCCustom/Compliance - specific compliance for an update list for a given Machine"
report_path_encoded = quote(report_path, safe="")

# Encode query parameters
machine_encoded = quote(machine)
update_list_encoded = quote(update_list)

# Final URL with encoded values
url = (
    f"{base_url}{report_path_encoded}"
    f"&Machine={machine_encoded}"
    f"&UpdateList={update_list_encoded}"
    f"&rs:Format=CSV"
)

# Authentication (update with valid credentials)
username = "your_username"
password = "your_password"

# Send request
response = requests.get(url, auth=HTTPBasicAuth(username, password))
response.raise_for_status()

# Save to CSV
output_file = f"{machine}_{update_list.replace(' ', '_')}.csv"
with open(output_file, "wb") as f:
    f.write(response.content)

print(f"Report saved as: {output_file}")
