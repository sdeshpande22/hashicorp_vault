# Load WinSCP .NET assembly
Add-Type -Path "path\to\WinSCPnet.dll"

# Set up session options
$sessionOptions = New-Object WinSCP.SessionOptions -Property @{
    Protocol = [WinSCP.Protocol]::Sftp
    HostName = "your_Citrix_ADM_server_IP"
    UserName = "your_username"
    Password = "your_password"
    # Comment out or remove the SshHostKeyFingerprint line if not available
    # SshHostKeyFingerprint = "your_ssh_host_key_fingerprint"
}

try {
    # Create session instance
    $session = New-Object WinSCP.Session

    try {
        # Connect
        $session.Open($sessionOptions)

        # Upload files
        $transferOptions = New-Object WinSCP.TransferOptions
        $transferOptions.TransferMode = [WinSCP.TransferMode]::Binary

        $transferResult = $session.PutFiles("local_path\*", "/remote_directory/", $False, $transferOptions)

        # Iterate over transfer results
        foreach ($transfer in $transferResult.Transfers) {
            Write-Host ("Upload of {0} succeeded" -f $transfer.FileName)
        }
    }
    finally {
        # Disconnect, clean up
        $session.Dispose()
    }

    exit 0
}
catch {
    Write-Host ("Error: {0}" -f $_.Exception.Message)
    exit 1
}
