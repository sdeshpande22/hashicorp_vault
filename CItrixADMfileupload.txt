$file_path = "C:\path\to\your\file\archive.tgz"

# URL for the upload endpoint
$url = "https://<ADM-IP>/nitro/v2/config/ns_image?action=upload"

# Create a hashtable for headers
$headers = @{
    "Content-Type" = "multipart/form-data"
}

# Set the security protocol to TLS 1.2
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

# Create the multipart/form-data content
$fileBytes = [System.IO.File]::ReadAllBytes($file_path)
$fileContent = [System.Net.Http.ByteArrayContent]::new($fileBytes)
$fileContent.Headers.ContentDisposition = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new("form-data")
$fileContent.Headers.ContentDisposition.Name = "file"
$fileContent.Headers.ContentDisposition.FileName = [System.IO.Path]::GetFileName($file_path)

$multipartContent = [System.Net.Http.MultipartFormDataContent]::new()
$multipartContent.Add($fileContent)

# Use Invoke-WebRequest to upload the file
try {
    $response = Invoke-WebRequest -Uri $url -Method Post -Headers $headers -Body $multipartContent -Verbose

    # Check the response
    if ($response.StatusCode -eq 200) {
        Write-Output "File uploaded successfully"
    } else {
        Write-Output "Failed to upload file. Status code: $($response.StatusCode)"
    }
} catch {
    Write-Output "Error uploading file: $_"
}
