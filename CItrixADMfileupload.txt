$file_path = "C:\path\to\your\file\largefile.tar.gz"

# URL for the upload endpoint
$url = "https://<ADM-IP>/nitro/v2/config/ns_image?action=upload"

# Credentials for headers
$nitroUser = "your-username"
$nitroPassword = "your-password"

# Function to report progress
function Report-Progress {
    param (
        [int64]$BytesTransferred,
        [int64]$TotalBytes
    )

    $percentComplete = ($BytesTransferred / $TotalBytes) * 100
    Write-Progress -Activity "Uploading File" -Status "Progress: $($percentComplete.ToString("F2"))% Complete" -PercentComplete $percentComplete
}

try {
    # Retrieve file size for progress calculation
    $fileSize = (Get-Item $file_path).Length
    $bytesUploaded = 0

    # Create a WebClient object for uploading
    $webClient = New-Object System.Net.WebClient
    $webClient.Headers.Add("X-Nitro-User", $nitroUser)
    $webClient.Headers.Add("X-Nitro-Password", $nitroPassword)

    # Event handler for upload progress
    $webClient.UploadProgressChanged += {
        param([object]$sender, [System.Net.UploadProgressChangedEventArgs]$e)
        Report-Progress -BytesTransferred $e.BytesSent -TotalBytes $e.TotalBytesToSend
    }

    # Upload the file
    $responseBytes = $webClient.UploadFile($url, $file_path)
    
    # Dispose WebClient object
    $webClient.Dispose()

    Write-Output "File uploaded successfully"
} catch {
    Write-Output "Error uploading file: $_"
}
