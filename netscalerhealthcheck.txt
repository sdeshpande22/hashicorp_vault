function Check-NetScalerHealth {
    param (
        [string]$netscalerIP,
        [string]$username,
        [string]$password,
        [int]$cpuThreshold = 80,
        [int]$memThreshold = 80,
        [int]$diskThreshold = 85,
        [int]$diskErrorThreshold = 1
    )

    # Define the headers for the Nitro API request
    $headers = @{
        'X-NITRO-USER' = $username
        'X-NITRO-PASS' = $password
    }

    # Fetch system stats for CPU and memory usage
    $systemUrl = "https://$netscalerIP/nitro/v1/stat/system"
    $systemStats = Invoke-RestMethod -Uri $systemUrl -Method Get -Headers $headers -SkipCertificateCheck

    # Fetch disk stats from the appropriate endpoint
    # Since `nsrpudisk` is not available, using the 'system' endpoint again to gather disk-related metrics
    $storageUrl = "https://$netscalerIP/nitro/v1/stat/system"
    $storageStats = Invoke-RestMethod -Uri $storageUrl -Method Get -Headers $headers -SkipCertificateCheck

    # Extract CPU and memory usage
    $cpuUsage = $systemStats.system.cpuusagepcnt
    $memUsage = $systemStats.system.memusagepcnt

    # Extract disk usage and disk errors (substitute with actual metrics available in your environment)
    $diskUsage = $storageStats.system.disk0perusage
    $diskErrors = $storageStats.system.diskerrcount

    # Display the results
    Write-Output "NetScaler Health Check:"
    Write-Output "========================"

    # Check CPU usage
    if ($cpuUsage -ge $cpuThreshold) {
        Write-Output "WARNING: CPU Usage is high at $cpuUsage% (Threshold: $cpuThreshold%)"
    } else {
        Write-Output "CPU Usage: $cpuUsage% (Normal)"
    }

    # Check Memory usage
    if ($memUsage -ge $memThreshold) {
        Write-Output "WARNING: Memory Usage is high at $memUsage% (Threshold: $memThreshold%)"
    } else {
        Write-Output "Memory Usage: $memUsage% (Normal)"
    }

    # Check Disk usage
    if ($diskUsage -ge $diskThreshold) {
        Write-Output "WARNING: Disk Usage is high at $diskUsage% (Threshold: $diskThreshold%)"
    } else {
        Write-Output "Disk Usage: $diskUsage% (Normal)"
    }

    # Check Disk Errors
    if ($diskErrors -ge $diskErrorThreshold) {
        Write-Output "WARNING: Disk Errors detected - $diskErrors errors (Threshold: $diskErrorThreshold)"
    } else {
        Write-Output "Disk Errors: $diskErrors (Normal)"
    }
}

# Example usage of the function
Check-NetScalerHealth -netscalerIP "192.168.1.1" -username "your_username" -password "your_password"
