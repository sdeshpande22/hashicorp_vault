function Get-ADMInstanceDetails {
    param (
        [string]$admIP,
        [string]$username,
        [string]$password,
        [string]$instanceIP
    )

    # Define the headers for the Nitro API request
    $headers = @{
        'X-NITRO-USER' = $username
        'X-NITRO-PASS' = $password
        'Content-Type' = 'application/json'
    }

    # Fetch the instance score from the ADM API
    $url = "https://$admIP/nitro/v1/config/instance_score?args=IPAddress:$instanceIP"
    $response = Invoke-RestMethod -Uri $url -Method Get -Headers $headers -SkipCertificateCheck

    # Extract relevant data
    $instanceScore = $response.instance_score[0]
    $indicators = @{
        "Flash Error" = $instanceScore.ind_flash_error
        "CPU Usage" = $instanceScore.ind_cpu_used
        "Power Error" = $instanceScore.ind_power_error
        "CPU Capacity Event" = $instanceScore.ind_capacity_cpu
        "Memory Usage" = $instanceScore.ind_memory_used
        "Disk Usage" = $instanceScore.ind_disk_used
        "Pooled License Events" = $instanceScore.ind_pooled_license_events
        "SSL Card Error" = $instanceScore.ind_ssl_card_error
        "Memory Capacity Event" = $instanceScore.ind_capacity_mem
    }

    # Data metrics
    $dataMetrics = @{
        "Instance State" = $instanceScore.instance_state
        "Data Memory Used (%)" = $instanceScore.data_memory_used
        "Disk0 Used Space (%)" = $instanceScore.data_disk0_used
        "Disk1 Used Space (%)" = $instanceScore.data_disk1_used
        "Packet CPU Usage (%)" = $instanceScore.data_cpu_used_packet
        "Management CPU Usage (%)" = $instanceScore.data_cpu_used_mgmt
    }

    # Display the results
    Write-Output "ADM Instance Health Check for $instanceIP:"
    Write-Output "=========================================="

    # Evaluate and print the indicators
    foreach ($key in $indicators.Keys) {
        $value = $indicators[$key]
        switch ($value) {
            0 { Write-Output "$key: No errors (0)" }
            1 { Write-Output "WARNING: $key - Error detected (1)" }
            -1 { Write-Output "$key: Not-Applicable/Unknown (-1)" }
            default { Write-Output "$key: Unknown value ($value)" }
        }
    }

    # Print the data metrics
    Write-Output "`nData Metrics:"
    foreach ($key in $dataMetrics.Keys) {
        $value = $dataMetrics[$key]
        Write-Output "$key: $value"
    }
}

# Example usage of the function
Get-ADMInstanceDetails -admIP "192.168.1.2" -username "your_adm_username" -password "your_adm_password" -instanceIP "192.168.1.1"
