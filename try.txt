# Define your Vault address and token
$vaultAddr = "VAULT_ADDR"
$token = "YOUR_VAULT_TOKEN"

# Define the role name
$roleName = "YOUR_ROLE_NAME"

# Define the Secret ID accessor to revoke
$secretIdAccessor = "YOUR_SECRET_ID_ACCESSOR"

# Define the path to the endpoint for revoking Secret ID accessor
$revokePath = "auth/approle/role/$roleName/secret-id-accessor/destroy"

# Prepare headers with the Vault token
$headers = @{
    "X-Vault-Token" = $token
}

# Prepare the request body with the Secret ID accessor to revoke
$body = @{
    accessor = $secretIdAccessor
} | ConvertTo-Json

# Revoke the Secret ID using its accessor
$response = Invoke-RestMethod -Uri "$vaultAddr/v1/$revokePath" -Method Post -Headers $headers -Body $body

# Check if the Secret ID was successfully revoked
if ($response.data.success -eq $true) {
    Write-Output "Secret ID revoked successfully"
} else {
    Write-Output "Failed to revoke Secret ID"
}
